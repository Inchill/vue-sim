<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue-sim test</title>
  <script src="../dist/sim.js"></script>
  <style>
    .done {
        text-decoration: line-through;
    }
    #app.all .all {
        font-weight: bold;
    }
    #app.remaining .todo.done {
        display: none;
    }
    #app.remaining .remaining {
        font-weight: bold;
    }
    #app.completed .todo:not(.done) {
        display: none;
    }
    #app.completed .completed {
        font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="app" class="all" s-controller="TodoList">
    <div>
      <input placeholder="what needs to be done?" s-on="change:addTodo"/>
    </div>
    <ul s-show="todos">
      <li class="todo" s-for="todo:todos" s-class="done:todo.done">
        <input type="checkbox" s-checked="todo.done" s-on="change:toggleTodo">
        <span s-text="todo.text"></span>
        <a s-on="click:removeTodo">X</a>
      </li>
    </ul>
    <div id="footer">
      Remaining:<span s-text="remaining"></span><br/>
      <a class="all" sd-on="click:filter">Show All</a> |
      <a class="remaining" sd-on="click:filter">Show Remaining</a> |
      <a class="completed" sd-on="click:filter">Show Completed</a>
    </div>
  </div>

  <script type="text/javascript">
    var data = {
    msg: 'hello vue-sim',
      total: 9999,
      error: true,
      todos: [
        {
          title: '1!',
          done: false
        },
        {
          title: '2!!',
          done: false
        },
        {
          title: '3!!!',
          done: false
        }
      ]
    }
    Sim.plant('TodoList', (scope, sim) => {
      sim.on('toggle', function (todo) {
        console.log(todo)
      })

      scope.remaining = scope.todos.reduce((count, todo) => {
        return count + (todo.done ? 0 : 1)
      }, 0)

      scope.addTodo = function (e) {
        var text = e.el.value
        if (text) {
          e.el.value = ''
          scope.todos.push({
            text: text,
            done: false
          })
          scope.remaining++
        }
      }

      scope.removeTodo = function (e) {
        var i = e.sim.eachIndex
        scope.todos.slice(i, 1)
      }

      scope.toggleTodo = function (e) {
        scope.remaining += e.sim.scope.done ? -1 : 1
      }

      scope.filter = function (e) {
        var filter = e.el.className
        sim.el.className = filter
      }
    })

    var now = Date.now()
    var app = Sim.sprout({
      el: '#app',
      data: data
    })
  </script>
</body>
</html>
